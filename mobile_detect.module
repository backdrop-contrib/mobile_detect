<?php

/**
 * Implements hook_registry_files_alter().
 */

function mobile_detect_registry_files_alter(&$files, $modules)
{
  $library_path = _mobile_detect_get_library_path();

  $files[$library_path . '/Mobile_Detect.php'] = array(
    'module' => 'mobile_detect',
    'weight' => 0,
  );
}

/**
 * Getter function to retrieve a Mobile_Detect() singleton for
 * the current page request
 */
 
function mobile_detect_get_object()
{
  $detect = &drupal_static(__FUNCTION__);

  if (!isset($detect)) {
    try {
      $detect = new Mobile_Detect();
    } catch (Exception $e) {
      $detect = NULL;
      watchdog('mobile_detect', 'Could not create a Mobile_Detect() object: %message', array('%message' => $e -> getMessage()), WATCHDOG_ALERT);
    }

  }

  return $detect;
}

/**
 * Implements hook_ctools_plugin_api().
 */

function mobile_detect_ctools_plugin_api($module, $api)
{
  if ($module == 'mobile_detect' && $api == 'mobile_detect') {
    return array('version' => 3);
  }
}

/**
 * Implements hook_ctools_plugin_directory().
 */

function mobile_detect_ctools_plugin_directory($module, $plugin)
{
  if ($plugin == 'access') {
    return 'plugins/' . $plugin;
  }
}

/**
 * Retrieve the path to the Mobile_Detect library; will use Libraries API if detected.
 */

function _mobile_detect_get_library_path()
{
  return function_exists('libraries_get_path') ? libraries_get_path('Mobile_Detect') : 'sites/all/libraries/Mobile_Detect';
}
